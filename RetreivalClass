package com.trackit.dev.trackitsystem;

import android.app.ProgressDialog;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.text.TextUtils;
import android.view.View;
import android.widget.Toast;
import android.widget.Spinner;
import com.google.firebase.database.DataSnapshot;
import com.google.firebase.database.DatabaseError;
import com.google.firebase.database.DatabaseReference;
import com.google.firebase.database.FirebaseDatabase;
import com.google.firebase.database.ValueEventListener;
import java.util.ArrayList;

public class RetreivalClass extends AppCompatActivity{

@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main2);
    }

/**
The Onstart method is overriden so as not to run this database request on the UI/Main Thread..
This is to promote good performance of your app
*/
    @Override
    protected void onStart() {
        retreiveAllSchools();
        areaSpinner = (Spinner) findViewById(R.id.school_spinners);
        areasAdapter = new ArrayAdapter<String>(Main2Activity.this, android.R.layout.simple_spinner_item, retreiveAllSchools());
        areasAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
        areaSpinner.setAdapter(areasAdapter);
        areaSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {
            @Override
            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {
                selection = (String) areaSpinner.getSelectedItem();

                areaSpinner.setSelection(areaSpinner.getSelectedItemPosition());
                Toast.makeText(Main2Activity.this, "You selected" + selection, Toast.LENGTH_SHORT).show();

                

            }

            @Override
            public void onNothingSelected(AdapterView<?> parent) {

            }
        });
        super.onStart();
    }
    
    String selection;
    FireBaseConnection fireBaseConnection;
ArrayList<String> schools = null;
    String schools_retreived = null;
    String resultProcessorObject = null;
    
    
    //My method for retreiving all schools from firebase database and return them as an ArrayList object of String
    private ArrayList<String> retreiveAllSchools() {
    //set a progress Bar for a good user experience
        pBar.setMessage("Please Wait..Retreiving Schools...");
        pBar.show();
//initialize my FirebaseConnection class to be able to access some of the fields declared there
        fireBaseConnection = new FireBaseConnection();
        
/**the object of the FireBaseConnectionClass is used to reference the reg_schools 
variable that references to all the schools registered
on our database*/ 

        fireBaseConnection.reg_schools.addListenerForSingleValueEvent(new ValueEventListener() {
            @Override
            public void onDataChange(DataSnapshot dataSnapshot) {

                for (DataSnapshot snapshot : dataSnapshot.getChildren()) {
                

                    resultProcessorObject = snapshot.child("school_name").getValue(String.class);
                    schools.add(resultProcessorObject);
                    count = dataSnapshot.getChildrenCount();


                }
                Toast.makeText(Main2Activity.this, "Total number of " + count + "schools found", Toast.LENGTH_SHORT).show();
                pBar.dismiss();
            }


            @Override
            public void onCancelled(DatabaseError databaseError) {

            }
        });
        return schools;
    }



}
